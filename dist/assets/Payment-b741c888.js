import{b6 as j,b7 as b,j as e,r as d,bi as I,a as l,u as z,bM as D,bN as O,Q as i,bO as R,bP as x,bQ as k,bR as w,k as V,bI as q}from"./index-34b13c5c.js";import{M as T}from"./Metadata-9d036ea2.js";import{C as B}from"./CheckoutSteps-a739ff24.js";import{d as L}from"./VpnKey-391c76e0.js";import{B as Q}from"./ButtonLoader-cd9fa06d.js";import{c as A}from"./orderActions-c478f828.js";import{T as F}from"./Typography-b169ff6b.js";import"./Stepper-493d89e5.js";var u={},J=b;Object.defineProperty(u,"__esModule",{value:!0});var g=u.default=void 0,G=J(j()),K=e,U=(0,G.default)((0,K.jsx)("path",{d:"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"}),"CreditCard");g=u.default=U;var p={},W=b;Object.defineProperty(p,"__esModule",{value:!0});var C=p.default=void 0,X=W(j()),Y=e,Z=(0,X.default)((0,Y.jsx)("path",{d:"M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"}),"Event");C=p.default=Z;function ce({apikey:P}){const[h,n]=d.useState(!1),E=I(),t=JSON.parse(sessionStorage.getItem("orderInfo")),{shippingInfo:s,cartItems:S}=l(a=>a.cart),{user:f}=l(a=>a.user),{error:o}=l(a=>a.newOrder),N={amount:Math.round(t.totalPrice*100)},c=z(),v=D(),_=O(),y={shippingInfo:s,orderItems:S,paymentInfo:"",itemsPrice:t==null?void 0:t.subtotal,taxPrice:t==null?void 0:t.tax,shippingPrice:t==null?void 0:t.shippingCharges,totalPrice:t==null?void 0:t.totalPrice},M=async a=>{a.preventDefault(),n(!0);try{const m={headers:{Authorization:`Bearer ${P}`,"Content-Type":"application/json"},withCredentials:!0},{data:$}=await q.post("https://becoomerce.onrender.com/api/v1/payment/process",N,m),H=$.client_secret;if(!v||!_)return;const r=await v.confirmCardPayment(H,{payment_method:{card:_.getElement(x),billing_details:{name:f.name,email:f.email,address:{city:s.city,state:s.state,postal_code:s.pincode,country:s.country,line1:s.address}}}});r.error?(n(!1),i.error(r.error.message,{theme:"dark"})):r.paymentIntent.status==="succeeded"?(y.paymentInfo={id:r.paymentIntent.id,status:r.paymentIntent.status},await A(c,y),E("/success")):(i.error("There's is some issue while processing payment",{theme:"dark"}),n(!1))}catch(m){n(!1),i.error(m.response.data.message,{theme:"dark"})}};return d.useEffect(()=>{o&&(i.error(o,{theme:"dark"}),c(R()))},[c,o]),e.jsxs(d.Fragment,{children:[e.jsx(T,{title:"Payment"}),e.jsx(B,{activeStep:2}),e.jsx("div",{className:"payment__container",children:e.jsxs("form",{className:"payment__form",onSubmit:a=>M(a),children:[e.jsx(F,{children:"Card Info"}),e.jsxs("div",{children:[e.jsx(g,{}),e.jsx(x,{className:"payment__input"})]}),e.jsxs("div",{children:[e.jsx(C,{}),e.jsx(k,{className:"payment__input"})]}),e.jsxs("div",{children:[e.jsx(L,{}),e.jsx(w,{className:"payment__input"})]}),e.jsx("button",{type:"submit",disabled:h,className:"payment__form__btn",children:h?e.jsx(Q,{}):`Pay -  â‚¹${t&&t.totalPrice}`})]})}),e.jsx(V,{})]})}export{ce as default};
